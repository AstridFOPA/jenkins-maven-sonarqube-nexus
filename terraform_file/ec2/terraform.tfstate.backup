{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 3,
  "lineage": "72bfaf3a-702d-b66b-63e6-26550df4d0ca",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "Maven_Hosted_Instance",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "ami": "ami-0ecb62995f68bb549",
            "arn": "arn:aws:ec2:us-east-1:864899864155:instance/i-0f7c4920817bdf7f8",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1a",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 2,
                "threads_per_core": 1
              }
            ],
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enable_primary_ipv6": null,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "force_destroy": false,
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "",
            "id": "i-0f7c4920817bdf7f8",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_lifecycle": "",
            "instance_market_options": [],
            "instance_state": "running",
            "instance_type": "t2.large",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "mykeypair",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_protocol_ipv6": "disabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_group_id": "",
            "placement_partition_number": 0,
            "primary_network_interface": [
              {
                "delete_on_termination": true,
                "network_interface_id": "eni-02252c2e6113c5aa2"
              }
            ],
            "primary_network_interface_id": "eni-02252c2e6113c5aa2",
            "private_dns": "ip-172-31-21-223.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "172.31.21.223",
            "public_dns": "ec2-107-23-182-98.compute-1.amazonaws.com",
            "public_ip": "107.23.182.98",
            "region": "us-east-1",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 3000,
                "kms_key_id": "",
                "tags": {},
                "tags_all": {},
                "throughput": 125,
                "volume_id": "vol-030b44aabd3e6c21b",
                "volume_size": 8,
                "volume_type": "gp3"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "Nexus-sg"
            ],
            "source_dest_check": true,
            "spot_instance_request_id": "",
            "subnet_id": "subnet-0cb322f16cdf6e0f6",
            "tags": {
              "Env": "dev",
              "Name": "Nexus_Instance"
            },
            "tags_all": {
              "Env": "dev",
              "Name": "Nexus_Instance"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "#!/bin/bash\r\n# Userdata script to Install Nexus on Ubuntu 24.04 VM\r\n# Instance Type Recommended: t2.large\r\n\r\n# Update package list\r\nsudo apt update -y\r\n\r\n# Install OpenJDK 17\r\nsudo apt install openjdk-17-jdk -y\r\n\r\n# Verify Java installation\r\njava --version\r\n\r\n# Download the latest Nexus tarball to /opt\r\nsudo wget https://download.sonatype.com/nexus/3/nexus-unix-x86-64-3.78.1-02.tar.gz -O /opt/latest-unix.tar.gz\r\n\r\n# Extract the tarball\r\nsudo tar -xvzf /opt/latest-unix.tar.gz -C /opt\r\n\r\n# Rename the extracted directory to /opt/nexus\r\n# Note: The exact version number may vary; using a wildcard to handle this\r\nsudo mv /opt/nexus-3.* /opt/nexus\r\n\r\n# Create a nexus user non-interactively\r\nsudo adduser --disabled-password --gecos \"\" nexus\r\n\r\n# Grant the nexus user sudo privileges without a password\r\nsudo su\r\necho \"nexus ALL=(ALL) NOPASSWD: ALL\" | sudo tee -a /etc/sudoers\r\n\r\n# Change ownership of nexus directories\r\nsudo chown -R nexus:nexus /opt/nexus\r\nsudo chown -R nexus:nexus /opt/sonatype-work\r\n\r\n# Configure the nexus.rc file to run as the nexus user\r\necho 'run_as_user=\"nexus\"' | sudo tee /opt/nexus/bin/nexus.rc\r\n\r\n# Append JVM options to nexus.vmoptions\r\ncat \u003c\u003cEOL | sudo tee -a /opt/nexus/bin/nexus.vmoptions\r\n-XX:MaxDirectMemorySize=2703m\r\n-Djava.net.preferIPv4Stack=true\r\nEOL\r\n\r\n# Create the systemd service file for Nexus\r\ncat \u003c\u003cEOL | sudo tee /etc/systemd/system/nexus.service\r\n[Unit]\r\nDescription=nexus service\r\nAfter=network.target\r\n\r\n[Service]\r\nType=forking\r\nLimitNOFILE=65536\r\nExecStart=/opt/nexus/bin/nexus start\r\nExecStop=/opt/nexus/bin/nexus stop\r\nUser=nexus\r\nRestart=on-abort\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nEOL\r\n\r\n# Reload systemd, start, and enable the Nexus service\r\nsudo systemctl daemon-reload\r\nsudo systemctl start nexus\r\nsudo systemctl enable nexus\r\n\r\n# Check the status of the Nexus service\r\nsudo systemctl status nexus\r\n\r\n# Allow Nexus default port (8081) through the firewall\r\nsudo su\r\nufw allow 8081/tcp\r\n",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-02a88504a13943596"
            ]
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "864899864155",
            "id": "i-0f7c4920817bdf7f8",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMiJ9"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "SonarQube_Hosted_Instance",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "ami": "ami-0ecb62995f68bb549",
            "arn": "arn:aws:ec2:us-east-1:864899864155:instance/i-0d9cf983fda73a90a",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1a",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 2,
                "threads_per_core": 1
              }
            ],
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enable_primary_ipv6": null,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "force_destroy": false,
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "",
            "id": "i-0d9cf983fda73a90a",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_lifecycle": "",
            "instance_market_options": [],
            "instance_state": "running",
            "instance_type": "t2.medium",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "mykeypair",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_protocol_ipv6": "disabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_group_id": "",
            "placement_partition_number": 0,
            "primary_network_interface": [
              {
                "delete_on_termination": true,
                "network_interface_id": "eni-04a7a835748274df0"
              }
            ],
            "primary_network_interface_id": "eni-04a7a835748274df0",
            "private_dns": "ip-172-31-26-26.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "172.31.26.26",
            "public_dns": "ec2-3-208-31-174.compute-1.amazonaws.com",
            "public_ip": "3.208.31.174",
            "region": "us-east-1",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 3000,
                "kms_key_id": "",
                "tags": {},
                "tags_all": {},
                "throughput": 125,
                "volume_id": "vol-06471269a547eba20",
                "volume_size": 8,
                "volume_type": "gp3"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "sonarqube-sg"
            ],
            "source_dest_check": true,
            "spot_instance_request_id": "",
            "subnet_id": "subnet-0cb322f16cdf6e0f6",
            "tags": {
              "Env": "dev",
              "Name": "Sonarqube_Instance"
            },
            "tags_all": {
              "Env": "dev",
              "Name": "Sonarqube_Instance"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "#!/bin/bash\r\ncp /etc/sysctl.conf /root/sysctl.conf_backup\r\ncat \u003c\u003cEOT\u003e /etc/sysctl.conf\r\nvm.max_map_count=262144\r\nfs.file-max=65536\r\nulimit -n 65536\r\nulimit -u 4096\r\nEOT\r\ncp /etc/security/limits.conf /root/sec_limit.conf_backup\r\ncat \u003c\u003cEOT\u003e /etc/security/limits.conf\r\nsonarqube   -   nofile   65536\r\nsonarqube   -   nproc    409\r\nEOT\r\n\r\nsudo apt-get update -y\r\nsudo apt-get install openjdk-11-jdk -y\r\nsudo update-alternatives --config java\r\n\r\njava -version\r\n\r\nsudo apt update\r\nwget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - | sudo apt-key add -\r\n\r\nsudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main\" \u003e\u003e /etc/apt/sources.list.d/pgdg.list'\r\nsudo apt install postgresql postgresql-contrib -y\r\n#sudo -u postgres psql -c \"SELECT version();\"\r\nsudo systemctl enable postgresql.service\r\nsudo systemctl start  postgresql.service\r\nsudo echo \"postgres:admin123\" | chpasswd\r\nrunuser -l postgres -c \"createuser sonar\"\r\nsudo -i -u postgres psql -c \"ALTER USER sonar WITH ENCRYPTED PASSWORD 'admin123';\"\r\nsudo -i -u postgres psql -c \"CREATE DATABASE sonarqube OWNER sonar;\"\r\nsudo -i -u postgres psql -c \"GRANT ALL PRIVILEGES ON DATABASE sonarqube to sonar;\"\r\nsystemctl restart  postgresql\r\n#systemctl status -l   postgresql\r\nnetstat -tulpena | grep postgres\r\nsudo mkdir -p /sonarqube/\r\ncd /sonarqube/\r\nsudo curl -O https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.3.0.34182.zip\r\nsudo apt-get install zip -y\r\nsudo unzip -o sonarqube-8.3.0.34182.zip -d /opt/\r\nsudo mv /opt/sonarqube-8.3.0.34182/ /opt/sonarqube\r\nsudo groupadd sonar\r\nsudo useradd -c \"SonarQube - User\" -d /opt/sonarqube/ -g sonar sonar\r\nsudo chown sonar:sonar /opt/sonarqube/ -R\r\ncp /opt/sonarqube/conf/sonar.properties /root/sonar.properties_backup\r\ncat \u003c\u003cEOT\u003e /opt/sonarqube/conf/sonar.properties\r\nsonar.jdbc.username=sonar\r\nsonar.jdbc.password=admin123\r\nsonar.jdbc.url=jdbc:postgresql://localhost/sonarqube\r\nsonar.web.host=0.0.0.0\r\nsonar.web.port=9000\r\nsonar.web.javaAdditionalOpts=-server\r\nsonar.search.javaOpts=-Xmx512m -Xms512m -XX:+HeapDumpOnOutOfMemoryError\r\nsonar.log.level=INFO\r\nsonar.path.logs=logs\r\nEOT\r\n\r\ncat \u003c\u003cEOT\u003e /etc/systemd/system/sonarqube.service\r\n[Unit]\r\nDescription=SonarQube service\r\nAfter=syslog.target network.target\r\n\r\n[Service]\r\nType=forking\r\n\r\nExecStart=/opt/sonarqube/bin/linux-x86-64/sonar.sh start\r\nExecStop=/opt/sonarqube/bin/linux-x86-64/sonar.sh stop\r\n\r\nUser=sonar\r\nGroup=sonar\r\nRestart=always\r\n\r\nLimitNOFILE=65536\r\nLimitNPROC=4096\r\n\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nEOT\r\n\r\nsystemctl daemon-reload\r\nsystemctl enable sonarqube.service\r\n#systemctl start sonarqube.service\r\n#systemctl status -l sonarqube.service\r\napt-get install nginx -y\r\nrm -rf /etc/nginx/sites-enabled/default\r\nrm -rf /etc/nginx/sites-available/default\r\ncat \u003c\u003cEOT\u003e /etc/nginx/sites-available/sonarqube\r\nserver{\r\n    listen      80;\r\n    server_name sonarqube.groophy.in;\r\n\r\n    access_log  /var/log/nginx/sonar.access.log;\r\n    error_log   /var/log/nginx/sonar.error.log;\r\n\r\n    proxy_buffers 16 64k;\r\n    proxy_buffer_size 128k;\r\n\r\n    location / {\r\n        proxy_pass  http://127.0.0.1:9000;\r\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;\r\n        proxy_redirect off;\r\n              \r\n        proxy_set_header    Host            \\$host;\r\n        proxy_set_header    X-Real-IP       \\$remote_addr;\r\n        proxy_set_header    X-Forwarded-For \\$proxy_add_x_forwarded_for;\r\n        proxy_set_header    X-Forwarded-Proto http;\r\n    }\r\n}\r\nEOT\r\nln -s /etc/nginx/sites-available/sonarqube /etc/nginx/sites-enabled/sonarqube\r\nsystemctl enable nginx.service\r\n#systemctl restart nginx.service\r\nsudo ufw allow 80,9000,9001/tcp\r\n\r\necho \"System reboot in 30 sec\"\r\nsleep 30\r\nreboot\r\n",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-017941dabc0afb5f6"
            ]
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "864899864155",
            "id": "i-0d9cf983fda73a90a",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMiJ9"
        }
      ]
    }
  ],
  "check_results": null
}
